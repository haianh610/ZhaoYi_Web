@model ZhaoYi_Test2.ViewModels.RegisterViewModel
@{
    ViewData["Title"] = "Đăng ký";
    Layout = "~/Views/Shared/_MobileLayout.cshtml";
    ViewData["ShowBottomNav"] = false;
}

@section Styles {
    <link rel="stylesheet" href="~/css/register.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/global-mobile.css" asp-append-version="true" />
    <style>
        /* Styling mở rộng/ghi đè */
        .mobile-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Validation thông báo lỗi */
        .validation-summary-errors {
            color: #d9534f;
            background-color: rgba(217, 83, 79, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            width: 100%;
            font-size: 14px;
        }

            .validation-summary-errors ul {
                list-style-type: none;
                padding: 0;
                margin: 0;
            }

        /* Lỗi riêng cho từng field */
        .field-validation-error {
            color: #ff3b30;
            font-size: 13px;
            display: block;
            margin-top: 5px;
            margin-bottom: 10px;
        }

        .input-validation-error {
            border-color: #ff3b30 !important;
        }
    </style>
}

<div class="content-wrapper">
    <h1 class="register-title">Đăng ký</h1>
    <div class="title-underline"></div>
    <p class="subtitle">Vui lòng đăng ký tài khoản của bạn để tiếp tục với ứng dụng</p>

    @if (!ViewData.ModelState.IsValid)
    {
        <div class="validation-summary-errors">
            <ul>
                @foreach (var modelState in ViewData.ModelState.Values)
                {
                    foreach (var error in modelState.Errors)
                    {
                        <li>@error.ErrorMessage</li>
                    }
                }
            </ul>
        </div>
    }

    <form asp-controller="Account" asp-action="Register" method="post" style="width: 100%;">
        @Html.AntiForgeryToken()
        <input type="hidden" name="returnUrl" value="@ViewData["ReturnUrl"]" />

        <div class="input-group">
            <i class="far fa-envelope"></i>
            <input type="email" asp-for="Email" placeholder="Email của bạn" required>
            <span asp-validation-for="Email" class="field-validation-error"></span>
        </div>

        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="passwordInput" asp-for="Password" placeholder="Mật khẩu của bạn" required>
            <i class="fas fa-eye-slash icon-right" id="togglePassword"></i>
            <span asp-validation-for="Password" class="field-validation-error"></span>
        </div>

        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="confirmPasswordInput" asp-for="ConfirmPassword" placeholder="Nhập lại mật khẩu" required>
            <i class="fas fa-eye-slash icon-right" id="toggleConfirmPassword"></i>
            <span asp-validation-for="ConfirmPassword" class="field-validation-error"></span>
        </div>

        <div class="terms-policy">
            <input type="checkbox" id="agreeTerms" required>
            <label for="agreeTerms">
                Tôi đồng ý với <a href="#">Điều khoản dịch vụ</a> và <a href="#">Chính sách bảo mật</a> của ZhaoYi
            </label>
        </div>

        <button type="submit" class="btn-primary">ĐĂNG KÝ</button>
    </form>

    <div class="separator">HOẶC</div>

    <button class="btn-social google">
        <img src="~/images/ic_google.png" alt="Google logo" width="18" height="18" />
        <span>Tiếp tục với Google</span>
    </button>
    <button class="btn-social facebook">
        <i class="fab fa-facebook-f"></i>
        <span>Tiếp tục với Facebook</span>
    </button>
    <button class="btn-social wechat">
        <i class="fab fa-weixin"></i>
        <span>Tiếp tục với Wechat</span>
    </button>

    <p class="login-link">
        Bạn đã có tài khoản? <a asp-controller="Account" asp-action="Login">Đăng nhập</a>
    </p>
</div>

@section Scripts {
    <script>
        // Script to toggle password visibility for both password fields
        document.addEventListener('DOMContentLoaded', function() {
            function setupPasswordToggle(inputId, toggleId) {
                const togglePassword = document.getElementById(toggleId);
                const passwordInput = document.getElementById(inputId);

                if (togglePassword && passwordInput) {
                    togglePassword.addEventListener('click', function () {
                        // Toggle the type attribute
                        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                        passwordInput.setAttribute('type', type);

                        // Toggle the icon
                        this.classList.toggle('fa-eye');
                        this.classList.toggle('fa-eye-slash');
                    });
                }
            }

            // Setup for the main password field
            setupPasswordToggle('passwordInput', 'togglePassword');

            // Setup for the confirm password field
            setupPasswordToggle('confirmPasswordInput', 'toggleConfirmPassword');

            // Form validation
            const form = document.querySelector('form');
            const passwordInput = document.getElementById('passwordInput');
            const confirmPasswordInput = document.getElementById('confirmPasswordInput');
            const agreeTerms = document.getElementById('agreeTerms');

            form.addEventListener('submit', function(event) {
                let hasError = false;

                // Validate password match
                if (passwordInput.value !== confirmPasswordInput.value) {
                    document.querySelector('[asp-validation-for="ConfirmPassword"]').textContent = 'Mật khẩu và mật khẩu xác nhận không khớp.';
                    hasError = true;
                }

                // Validate terms agreement
                if (!agreeTerms.checked) {
                    agreeTerms.nextElementSibling.style.color = '#ff3b30';
                    hasError = true;
                }

                if (hasError) {
                    event.preventDefault();
                }
            });

            // Remove error styling when checking the terms
            agreeTerms.addEventListener('change', function() {
                if (this.checked) {
                    this.nextElementSibling.style.color = '';
                }
            });
        });
    </script>
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
